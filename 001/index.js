/*QUIK_ADDON 1|天气|7|1.0.6|在QUIK起始页左上角显示今日天气|siquan|https://image.gumengya.com/i/2024/07/29/66a737fbaefad.png|https://siquan001.github.io/|version.txt|siquan.weather */
var e=quik.storage("q-weather-cache");(function(){var t=new quik.dialog({content:'<div class="lic-c"><h1>天气 插件使用须知</h1><h2>用户协议</h2><p>1. 天气数据来源于“腾讯天气”，其中若有内容问题，请联系“腾讯天气”相关负责人，本插件与QUIK起始页不负责任。</p><p>1. 位置数据来源于“腾讯地图API”，其中若有内容问题，请联系“腾讯地图API”相关负责人，本插件与QUIK起始页不负责任。</p><h2>隐私政策</h2><p>1. 我们需要收集您的IP地址以获取您的大致位置信息，我们只是确定您所在的市、县、区，您的精确位置不会被定位</p></div><div class="btns"><div class="btn cancel">不同意</div><div class="btn ok">同意</div></div>'}),a=t.getDialogDom();util.query(a,".btn.cancel").onclick=function(){i(!1),t.close()},util.query(a,".btn.ok").onclick=function(){e.set("lic",!0),i(!0),t.close()};var i=function(){};return function(a){e.get("lic")?a(!0):(i=a,t.open())}})()((function(t){t?function(){var t,a=((t={"00":"66a737fb017be","01":"66a737fbaefad","02":"66a737fc39b2c",24:"66a737fe2b1fc",25:"66a737ff46681",26:"66a738006abf2",27:"66a7380188b94",28:"66a7380188b94",29:"66a73803a4c1a",30:"66a73804bad7c",31:"66a73805b47a3",32:"66a73806ca722",n00:"66a73807e8133","03":"66a738090bb51",n01:"66a7380a2c03d",n03:"66a7380b1f7b4",n13:"66a7380c26f8e",23:"66a7380faa05c",22:"66a738102678b",21:"66a738109f9b0",20:"66a73805b47a3",19:"66a73811862e0",18:"66a73806ca722",17:"66a7380188b94",16:"66a7380188b94",15:"66a738006abf2",14:"66a73814b6e34",13:"66a7381654d30",12:"66a737ff46681",11:"66a737fe2b1fc",10:"66a7380faa05c","09":"66a738102678b","08":"66a738109f9b0","07":"66a73819283a8","06":"66a7381a44dcd","05":"66a7381b11643","04":"66a7381b6adf8",301:"66a73c8198366"})[302]=t[14],{get:function(e,a){return"https://image.gumengya.com/i/2024/07/29/"+(a&&-1!=["00","01","03","13"].indexOf(e)?t["n"+e]:t[e])+".png"}}),i={location:null,weather:null},n=quik.util,c=!1,r=!1,o=[];e.get("location")&&(i.location=e.get("location"));var s={province:"北京",city:"北京",district:void 0};function l(t,a={}){!i.location||a.refresh?o.push(quik.util.jsonp("https://apis.map.qq.com/ws/location/v1/ip?key=DX2BZ-AGNK7-T62XY-H4KZZ-KOUWF-KAB3T&output=jsonp",(function(a){a&&0==a.status?(i.location=a.result.ad_info,e.set("location",a.result.ad_info),t(a.result.ad_info)):t(s)}))):t(i.location)}function d(e,t={}){quik.util.checkDetailsCorrect(t,["province","city","county"])?i.weather&&function(e,t){if(Object.keys(e).length>t){for(var a in e)if(e[a]!=t[a])return!1}else for(var a in t)if(e[a]!=t[a])return!1;return!0}(i.weather.offset,{province:t.province,city:t.city,county:t.county})&&!t.refresh?e(i.weather.data):o.push(quik.util.jsonp("https://wis.qq.com/weather/common?source=pc&weather_type=observe%7Cforecast_1h%7Cforecast_24h%7Cair%7Crise%7Calarm&province="+(t.province||"")+"&city="+(t.city||"")+"&county="+(t.county||"")+"&_="+Date.now(),(function(a){a&&200==a.status?o.push(quik.util.jsonp("https://wis.qq.com/weather/common?source=pc&weather_type=air%7Crise&province="+t.province+"&city="+t.city+"&_="+Date.now(),(function(n){a&&200==a.status&&(a.data.air=n.data.air),i.weather={offset:{province:t.province,city:t.city,county:t.county},data:a.data},e(a.data)}))):e({err:!0,code:-2,msg:a?a.status+" "+a.message:"网络错误"})}))):e({err:!0,code:-1,msg:"内容不齐"})}var u=new quik.iconc.icon({content:`<div><span class="location-text">...</span>\n        <img class="weather-img" src="${a.get("02")}"/>\n        <span class="weather-text">...</span>\n        <span class="degree-text">...</span></div>`,width:150,offset:"tl",class:"weather-icon",important:!0});function p(){var e=u.getIcon();n.query(e,".location-text").innerText=n.query(y,".con.a .location span:nth-child(2)").innerText="--",n.query(y,".con.a .weather-name").innerText=n.query(e,".weather-text").innerText="--",n.query(y,".con.a .weather-temp").innerText=n.query(e,".degree-text").innerText="-℃",n.query(y,".con.a img").src=n.query(e,".weather-img").src=a.get("02"),n.query(y,".con.a .weather-wind span:nth-child(2)").innerText="-风---级",n.query(y,".con.a .weather-wet span:nth-child(2)").innerText="--%",n.query(y,".con.a .weather-pa span:nth-child(2)").innerText="--hPa",n.query(y,".con.b .sc ul").innerHTML="",n.query(y,".con.c .sc ul").innerHTML="",n.query(y,".con.d .aqi .result").innerHTML="-",n.query(y,".con.d .aqi .pinjia").innerHTML="-",n.query(y,".con.d .aqi .pinjia").style.background="",n.query(y,".con.d .co .result").innerHTML="-",n.query(y,".con.d .no2 .result").innerHTML="-",n.query(y,".con.d .o3 .result").innerHTML="-",n.query(y,".con.d .pm25 .result").innerHTML="-",n.query(y,".con.d .pm10 .result").innerHTML="-",n.query(y,".con.d .so2 .result").innerHTML="-",n.query(y,".con.a .weather-alarm").innerText="",n.query(y,".con.a .weather-alarm").style.background="",n.query(y,".con.a .weather-alarm").onclick=function(){}}function h(e){o.forEach((function(e){e.abort()})),d((function(t){if(t.err)quik.toast.show("天气请求错误（ERR:"+t.msg+"）");else{var i=u.getIcon();n.query(i,".location-text").innerText=n.query(y,".con.a .location span:nth-child(2)").innerText=e.district||e.city||e.province,n.query(y,".con.a .weather-name").innerText=n.query(i,".weather-text").innerText=t.observe.weather,n.query(y,".con.a .weather-temp").innerText=n.query(i,".degree-text").innerText=t.observe.degree+"℃",n.query(y,".con.a img").src=n.query(i,".weather-img").src=a.get(t.observe.weather_code,f(t.rise[0])),n.query(y,".con.a .weather-wind span:nth-child(2)").innerText=t.observe.wind_direction_name+t.observe.wind_power+"级",n.query(y,".con.a .weather-wet span:nth-child(2)").innerText=t.observe.humidity+"%",n.query(y,".con.a .weather-pa span:nth-child(2)").innerText=t.observe.pressure+"hPa";var r=n.query(y,".con.b .sc ul"),o=t.forecast_24h,s="",l=0;for(var d in o)l++,s+='<li><p class="time">'+o[d].time.split("-")[1]+"-"+o[d].time.split("-")[2]+'</p><img src="'+a.get(o[d].day_weather_code)+'"><img src="'+a.get(o[d].night_weather_code,!0)+'"><p class="temp">'+o[d].min_degree+"℃~"+o[d].max_degree+'℃</p><p class="wind">'+o[d].day_wind_direction+o[d].day_wind_power+"级-"+o[d].night_wind_direction+o[d].night_wind_power+"级</p></li>";r.innerHTML=s,r.style.width=100*l+"px";var p=n.query(y,".con.c .sc ul"),h=t.forecast_1h,v="",w=0;for(var d in h)w++,v+='<li><p class="time">'+h[d].update_time.substring(8,10)+':00</p><img src="'+a.get(h[d].weather_code,f(t.rise[0],parseInt(h[d].update_time.substring(8,10))))+'"/><p class="temp">'+h[d].degree+'℃</p><p class="wind">'+h[d].wind_direction+h[d].wind_power+"级</p></li>";p.innerHTML=v,p.style.width=100*w+"px";var g=t.air;if(n.query(y,".con.d .aqi .result").innerHTML=g.aqi,n.query(y,".con.d .aqi .pinjia").innerHTML=g.aqi_name,n.query(y,".con.d .aqi .pinjia").style.background=["","#a3d765","#f0cc35","#f1ab62","#ef7f77","#b28ccb","#ad788a"][g.aqi_level],n.query(y,".con.d .co .result").innerHTML=g.co,n.query(y,".con.d .no2 .result").innerHTML=g.no2,n.query(y,".con.d .o3 .result").innerHTML=g.o3,n.query(y,".con.d .pm25 .result").innerHTML=g["pm2.5"],n.query(y,".con.d .pm10 .result").innerHTML=g.pm10,n.query(y,".con.d .so2 .result").innerHTML=g.so2,t.alarm[0]){n.query(y,".con.a .weather-alarm").innerText=t.alarm[0].type_name+t.alarm[0].level_name+"预警";n.query(y,".con.a .weather-alarm").style.background={"01":"#86c5f7","02":"#f5d271","03":"#ef8c6b","04":"#ec807c"}[t.alarm[0].level_code],n.query(y,".con.a .weather-alarm").onclick=function(){quik.alert(t.alarm[0].detail,(function(){setTimeout((function(){c=!1}),10)})),c=!0}}}}),{province:e.province,city:e.city,county:e.district,refresh:!0})}function f(e,t){var a=e.sunrise.split(":");a=60*parseInt(a[0])+parseInt(a[1]);var i,n=e.sunset.split(":");return n=60*parseInt(n[0])+parseInt(n[1]),!(a<(i=void 0===t?60*(i=new Date).getHours()+i.getMinutes():60*t)&&i<n)}u.show(),u.getIcon().onclick=function(e){r=!0,v.show(300),v.setOffset({top:34,left:15},300)},document.addEventListener("click",(function(){c||(r?r=!1:(v.hide(300),v.setOffset({top:34,left:-315},300)))})),l((function(e){h(e)}));var v=new quik.card({content:'<div class="tabi"><div class="item" data-i="a">今日</div><div class="item" data-i="b">七日天气</div><div class="item" data-i="c">24小时</div><div class="item" data-i="d">空气质量</div></div><div class="tabcon"><div class="con a" data-i="a"><div class="left"><div class="location"><span title="定位" class="relocate">icon{e0c8}</span><span class="replacecity" title="切换城市">---</span></div><div class="weatherss"><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/01.png"><p class="weather-temp">--℃</p><p class="weather-name">--</p></div></div><div class="right"><p class="weather-wind">icon{e569}<span>-风---级</span></p><p class="weather-wet">icon{e798}湿度 <span>--%</span></p><p class="weather-pa">icon{e87a}气压 <span>---hPa</span></p><p class="weather-alarm"></p></div></div><div class="con b" data-i="b"><div class="sc"><ul></ul></div></div><div class="con c" data-i="c"><div class="sc"><ul></ul></div></div><div class="con d" data-i="d"><div class="aqi"><p class="title">AQI</p><p class="result">-</p><p class="pinjia">-</p></div><div class="wurans"><div class="co"><p class="title">CO</p><p class="result">-</p></div><div class="no2"><p class="title">NO<sub>2</sub></p><p class="result">-</p></div><div class="o3"><p class="title">O<sub>3</sub></p><p class="result">-</p></div><div class="pm25"><p class="title">PM2.5</p><p class="result">-</p></div><div class="pm10"><p class="title">PM10</p><p class="result">-</p></div><div class="so2"><p class="title">SO<sub>2</sub></p><p class="result">-</p></div></div></div></div>'.replace(/icon{[a-zA-Z0-9]*}/g,(function(e){return n.getGoogleIcon(e.replace("icon{","").replace("}",""))})),class:"weather-card",width:300,height:200,offset:{top:34,left:-315}}),y=v.getCardDom();y.addEventListener("click",(function(e){r=!0}));var w=n.query(y,".tabi .item",!0),g=n.query(y,".tabcon .con",!0);w.forEach((function(e){e.onclick=function(){w.forEach((function(e){e.classList.remove("active")})),g.forEach((function(e){e.classList.remove("active")})),this.classList.add("active"),n.query(y,'.tabcon .con[data-i="'+this.dataset.i+'"]').classList.add("active")}})),n.query(y,".relocate").addEventListener("click",(function(){p(),o.forEach((function(e){e.abort()})),l((function(e){h(e)}),{refresh:!0})}));var b,m,q,x=(b=new quik.dialog({content:'<div class="bar"><div class="closeBtn">{e5cd}</div><div class="searchcitybox"><input type="search" class="searchcityinput" placeholder="搜索市、区、县等"></div></div><div class="results"></div>'.replace("{e5cd}",n.getGoogleIcon("e5cd")),class:"cityselector",clickOtherToClose:!1}),m=function(){},q=b.getDialogDom(),n.query(q,".closeBtn").addEventListener("click",(function(){setTimeout((function(){c=!1}),10),m(!1),b.close()})),n.query(q,".searchcityinput").addEventListener("input",(function(){if(""!=this.value.trim())var e=this.value.trim();n.jsonp("https://wis.qq.com/city/like?source=pc&city="+encodeURI(e),(function(t){if(t&&200==t.status){var a="";for(var i in t.data)a+='<div class="item" data-t="'+t.data[i]+'">'+t.data[i].replace(e,'<span style="color:#09f">'+e+"</span>")+"</div>";n.query(q,".results").innerHTML=a,n.query(q,".results .item",!0).forEach((function(e){e.onclick=function(){var e=this.dataset.t.split(", ");m({province:e[0],city:e[1],county:e[2]}),n.query(q,".results").innerHTML="",b.close(),setTimeout((function(){c=!1}),10)}}))}else n.query(q,".results").innerHTML="网络错误"}))})),function(e){c=!0,b.open(),m=e});n.query(y,".replacecity").addEventListener("click",(function(){x((function(t){t&&(e.set("location",{province:t.province,city:t.city,district:t.county}),i.location={province:t.province,city:t.city,district:t.county},p(),h({province:t.province,city:t.city,district:t.county}))}))})),w[0].click(),quik.util.addStyle(".weather-icon>div{display:flex;justify-content:center;align-items:center}.weather-icon>div>*{height:30px;line-height:30px;margin:0 2px;font-size:14px}.weather-icon img{height:24px;margin:3px 2px}.weather-card{user-select:none}.weather-card .tabi{width:100%;height:30px}.weather-card .tabi .item{float:left;margin:3px 5px;line-height:20px;height:20px;font-size:12px;padding:1px 5px;border-radius:3px;user-select:none}.weather-card .tabi .item.active{background-color:#eee}.weather-card .tabi .item:hover{background-color:#f6f6f6}.weather-card .tabcon{width:100%;height:calc(100% - 30px)}.weather-card .tabcon .con{width:100%;height:100%;display:none}.weather-card .tabcon .con.active{display:block}.weather-card .tabcon .con.a .left,.weather-card .tabcon .con.a .right{width:50%;height:100%;float:left;display:flex;justify-content:center;align-items:center;flex-direction:column}.weather-card .tabcon .con.a{text-align:center;line-height:20px}.weather-card .tabcon .con.a .right p{padding:5px 0}.weather-card .tabcon .con.a .right .weather-alarm{cursor:pointer;padding:0 1em;border-radius:1em;color:#fff;font-size:14px}.weather-card .tabcon .con.a .material-symbols-outlined{font-size:inherit;padding-right:5px;line-height:inherit;float:left}.weather-card .tabcon .sc{width:100%;height:100%;overflow-y:hidden;overflow-x:auto}.weather-card .tabcon .sc ul{height:100%}.weather-card .tabcon .sc ul li{width:80px;height:100%;margin:0 10px;float:left;list-style:none;font-size:12px;text-align:center}.weather-card .tabcon .sc ul li img{width:35px;display:block;height:35px;margin:0 auto}.weather-card .tabcon .con.c .sc ul li{font-size:16px}.weather-card .tabcon .con.c .sc ul li img{width:50px;height:50px}.weather-card .tabcon .con.c .sc ul li p.time{padding-top:10px}.weather-card .tabcon .con.c .sc ul li p.wind{font-size:12px}.weather-card .tabcon .con.d .aqi{width:80px;height:calc(100% - 40px);padding:20px 0;float:left;display:flex;flex-direction:column;justify-content:space-between;align-items:center}.weather-card .tabcon .con.d .aqi .result{font-size:20px}.weather-card .tabcon .con.d .wurans{float:left;width:calc(100% - 80px);height:100%}.weather-card .tabcon .con.d .wurans>*{float:left;width:calc(33% - 10px);height:calc(50% - 10px);display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#fafafa;border-radius:10px;margin:5px}.weather-card .tabcon .con.d .aqi p.pinjia{width:1em;height:1em;line-height:1em;border-radius:3px;font-size:12px;padding:4px}.cityselector .bar{overflow:hidden}.cityselector .bar>*{float:left;height:30px;font-size:16px;user-select:none}.cityselector .bar input{height:30px}.d-c.cityselector{height:300px}.cityselector .results{height:calc(100% - 30px);overflow:auto}body.dark .cards .weather-card{background-color:#333}body.dark .weather-card .tabi .item.active{background-color:#555}body.dark .weather-card .tabi .item:hover{background-color:#444}body.dark .weather-card .tabcon .con.d .wurans>*{background-color:#3a3a3a}")}():quik.alert("如您不同意，请卸载本插件。")}));